{% extends 'mainapp/base.html' %}

{% block body_block %}
<style>
    .slider {
        position: relative;
        width: 100%;
        max-width: 100%;
        margin: auto;
        overflow: hidden;
    }

    .slides .slide {
        display: none;
        width: 100%;
        height: 480px;
        background-size: 100% 100%;
        background-position: center;
        background-repeat: no-repeat;
        cursor: pointer;
    }

    .prev, .next {
        cursor: pointer;
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: auto;
        padding: 16px;
        margin-top: -22px;
        color: white;
        font-weight: bold;
        font-size: 18px;
        transition: 0.6s ease;
        border-radius: 0 3px 3px 0;
        user-select: none;
    }

    .next {
        right: 0;
        border-radius: 3px 0 0 3px;
    }

    .prev:hover, .next:hover {
        background-color: rgba(0, 0, 0, 0.8);
    }

    .button-schedule-viewing {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 10px 25px;
        font-size: 16px;
        font-weight: 600;
        color: #ffffff;
        background-color: #007bff;
        border: none;
        border-radius: 25px;
        text-decoration: none;
        box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.25);
        outline: none;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    .button-schedule-viewing:hover {
        background-color: #0056b3;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.25);
    }

    .grid > div {
        background-color: #f8faff;
        border: 1px solid #d1e3f8;
    }

    body {
        background-color: #f0f3f8
                {##f3f4f6;#}
    }
    .modal {
        display: none;
        position: fixed;
        z-index: 10000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgb(0,0,0);
        background-color: rgba(0,0,0,0.9);
    }

    /* Modal Content */
    .modal-content {
        position: relative;
        margin: auto;
        padding: 0;
        width: 80%;
        max-width: 1200px;
    }
    .full-screen-modal {
        display: none;
        position: fixed;
        z-index: 9999;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        padding-top: 50px;
        overflow: auto;
        background-color: rgb(0,0,0);
        background-color: rgba(0,0,0,0.9);
        cursor: pointer;
    }

    .full-screen-modal-content {
        margin: auto;
        display: block;
        width: 80%;
        max-width: 700px;
        max-height: 90vh;
        animation-name: zoom;
        animation-duration: 0.6s;
    }

    @keyframes zoom {
        from {transform: scale(0)}
        to {transform: scale(1)}
    }

    .close-modal {
        position: absolute;
        top: 15px;
        right: 35px;
        color: #f1f1f1;
        font-size: 40px;
        font-weight: bold;
        transition: 0.3s;
    }

    .close-modal:hover,
    .close-modal:focus {
        color: #bbb;
        text-decoration: none;
        cursor: pointer;
    }

    .close {
        color: white;
        position: absolute;
        top: 10px;
        right: 25px;
        font-size: 35px;
        font-weight: bold;
    }

    .close:hover,
    .close:focus {
        color: #999;
        text-decoration: none;
        cursor: pointer;
    }

    .mySlides {
        display: none;
    }

    .prev,
    .next {
        cursor: pointer;
        position: absolute;
        top: 50%;
        width: auto;
        padding: 16px;
        margin-top: -50px;
        color: white;
        font-weight: bold;
        font-size: 20px;
        transition: 0.6s ease;
        border-radius: 0 3px 3px 0;
        user-select: none;
        -webkit-user-select: none;
    }

    .next {
        right: 0;
        border-radius: 3px 0 0 3px;
    }

    .prev:hover,
    .next:hover {
        background-color: rgba(0,0,0,0.8);
    }

</style>
<div class="m-8">
    {# Description Section #}
{#    <div class="">#}
{#        <h1 class="text-3xl font-bold">{{ property.title }}</h1>#}
{#        <p class="mt-2 text-lg">{{ property.address }}</p>#}
{#    </div>#}
    {# Description Section #}

    {# Image Section #}
    <div>
{#        <h1 class="text-2xl font-bold mt-6">Property Images</h1>#}
        <div id="slider" class="slider">
            <div class="slides">
                {% if property.prop_image1 %}
            <div class="slide" style="background-image: url('{{ property.prop_image1.url }}');" onclick="openModal();currentSlide(1)"></div>
                {% endif %}
                {% if property.prop_image2 %}
            <div class="slide" style="background-image: url('{{ property.prop_image2.url }}');" onclick="openModal();currentSlide(2)"></div>
                {% endif %}
                {% if property.prop_image3 %}
            <div class="slide" style="background-image: url('{{ property.prop_image3.url }}');" onclick="openModal();currentSlide(3)"></div>
                {% endif %}
                {% if property.prop_image4 %}
            <div class="slide" style="background-image: url('{{ property.prop_image4.url }}');" onclick="openModal();currentSlide(4)"></div>
                {% endif %}
                {% if property.prop_image5 %}
            <div class="slide" style="background-image: url('{{ property.prop_image5.url }}');" onclick="openModal();currentSlide(5)"></div>
                {% endif %}

            </div>
            <a class="prev" onclick="moveSlide(-1)">&#10094;</a>
            <a class="next" onclick="moveSlide(1)">&#10095;</a>
        </div>
    </div>
    {# Image Section #}
     <div id="myModal" class="modal">
        <span class="close cursor" onclick="closeModal()">&times;</span>
        <div class="modal-content">
            {% if property.prop_image1 %}
            <div class="mySlides">
                <img src="{{ property.prop_image1.url }}" style="width:100%">
            </div>
            {% endif %}
            {% if property.prop_image2 %}
            <div class="mySlides">
                <img src="{{ property.prop_image2.url }}" style="width:100%">
            </div>
            {% endif %}
            {% if property.prop_image3 %}
            <div class="mySlides">
                <img src="{{ property.prop_image3.url }}" style="width:100%">
            </div>
            {% endif %}
            {% if property.prop_image4 %}
            <div class="mySlides">
                <img src="{{ property.prop_image4.url }}" style="width:100%">
            </div>
            {% endif %}
            {% if property.prop_image5 %}
            <div class="mySlides">
                <img src="{{ property.prop_image5.url }}" style="width:100%">
            </div>
            {% endif %}
            <a class="prev" onclick="plusSlides(-1)">&#10094;</a>
            <a class="next" onclick="plusSlides(1)">&#10095;</a>
        </div>
    </div>
<div id="imageModal" class="full-screen-modal" onclick="closeModal()">
    <span class="close-modal" onclick="closeModal()">&times;</span>
    <img class="full-screen-modal-content" id="expandedImg">
</div>
    {# Description + Price Section #}
    <div class="flex flex-row gap-8 mt-8">
        <div class="bg-white shadow-md rounded-lg p-8 w-3/4">
            <div class="w-full flex justify-between items-center">
                <div class="w-full flex items-center justify-between">
                    <div class="flex flex-col flex-1 w-full">
                        <h2 class="text-2xl font-medium text-gray-800">{{ property.title }}</h2>
                        <p class="flex-1 text-gray-600">{{ property.address }}</p>
                    </div>
                </div>
                 <div class="text-center">
                    {% if property.availability_status == "available" %}
                      <button class="bg-green-500 hover:bg-green-700 text-white font-bold py-1 px-2 rounded mr-1">{{ property.availability_status|upper }}</button>
                    {% elif property.availability_status == "not_available" %}
                        <button class="bg-red-500 hover:bg-red-700 text-white font-bold py-1 px-2 rounded mr-1">{{ property.availability_status|upper }}</button>
                    {% elif property.availability_status == "coming_soon" %}
                      <button class="bg-orange-500 hover:bg-orange-700 text-white font-bold py-1 px-2 rounded mr-1">{{ property.availability_status|upper }}</button>
                    {% endif %}
                </div>

            </div>
            <div class="flex -mt-3 text-xl p-4">
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mt-4 -ml-4">
                <div class="px-6 py-4 bg-white shadow-sm rounded-lg">
                    <p class="text-2xl text-center text-gray-500">{{ property.number_of_bathrooms}}</p>
                    <h4 class="text-md font-medium text-center text-gray-900 -mt-1">Bedrooms</h4>
                </div>
                <div class="px-6 py-4 bg-white shadow-sm rounded-lg">
                    <p class="text-2xl text-center text-gray-500">{{ property.number_of_bedrooms }}</p>
                    <h4 class="text-md font-medium text-center text-gray-900 -mt-1">Bathrooms</h4>
                </div>
                    <div class="px-6 py-4 bg-white shadow-sm rounded-lg">
                        <p class="text-2xl text-center text-gray-500">{{ property.allowed_lease_people }}</p>
                        <h4 class="text-md font-medium text-gray-900 -mt-1">People Allowed</h4>
                </div>
                </div>
            </div>

            <div>
                <h3 class="font-bold mt-8">Description</h3>
                <p class="flex-1 text-gray-600">{{ property.description }}</p>
            </div>
            <div>
                <h3 class="flex-1 mt-8 font-bold">House Rules</h3>
                <p class="flex-1 text-gray-600">{{ property.rules|linebreaks }}</p>
            </div>

            <div class="mt-6">
                <h3 class="text-lg leading-6 font-medium text-gray-900">Informations</h3>

                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mt-2">
                    <div class="px-6 py-4 bg-white shadow-sm rounded-lg">
                        <h4 class="text-sm font-medium text-gray-900">Property Type</h4>
                        <p class="text-sm text-gray-500">{{ property.get_property_type_display }}</p>
                    </div>
                    <div class="px-6 py-4 bg-white shadow-sm rounded-lg">
                        <h4 class="text-sm font-medium text-gray-900">Lease Duration (Months)</h4>
                        <p class="text-sm text-gray-500">{{ property.lease_duration }}</p>
                    </div>
                    <div class="px-6 py-4 bg-white shadow-sm rounded-lg">
                        <h4 class="text-sm font-medium text-gray-900">Is Biddable?</h4>
                        <p class="text-sm text-gray-500">{{ property.is_biddable|yesno:"Yes,No" }}</p>
                    </div>
                    <div class="px-6 py-4 bg-white shadow-sm rounded-lg">
                        <h4 class="text-sm font-medium text-gray-900">Minimum Bidding Limit</h4>
                        <p class="text-sm text-gray-500">${{ property.bidding_min_limit }}</p>
                    </div>
                    <div class="px-6 py-4 bg-white shadow-sm rounded-lg">
                        <h4 class="text-sm font-medium text-gray-900">House Build Date</h4>
                        <p class="text-sm text-gray-500">{{ property.house_build_date|date:"F j, Y" }}</p>
                    </div>
                </div>
            </div>

            <div class="mt-6">
                <h3 class="text-lg leading-6 font-medium text-gray-900">Amenities</h3>

                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mt-2">
                    <div class="px-6 py-4 bg-white shadow-sm rounded-lg">
                        <h4 class="text-sm font-medium text-gray-900">Hydro</h4>
                        <p class="text-sm text-gray-500">{{ property.amenities|linebreaks }}</p>
                    </div>
                </div>
            </div>

            <div class="mt-8">
                {% if property.availability_status == "available" and 'user_type' in request.session and request.session.user_type == "student" %}
                   {% if bid.student.username != request.user.username %}
                       <a href="{% url 'bidding' property.id %}" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                            Make a Bid
                        </a>
                    {% endif %}


                {% endif %}
            </div>
        </div>
        <div class="bg-white shadow-md rounded-lg p-6 h-96 w-1/4 self-start">
            <div class="flex items-center justify-between">
                <h3 class="flex font-bold text-2xl">Price</h3>
                <div class="flex text-xl">
                    <h2>${{ property.price }}</h2>
                </div>
            </div>
            <div class="flex items-center justify-between">
                <p class="flex">Monthly Payment (+1 month)</p>
                <p class="flex">${{ property.price | add:property.price}}</p>
            </div>


        </div>
    </div>

</div>
<script>
    var slideIndex = 1;
    showSlide(slideIndex);
    function openModal() {
        document.getElementById('myModal').style.display = "block";
    }

    // Close the Modal
    function closeModal() {
        document.getElementById('myModal').style.display = "none";
    }

    var slideIndex = 1;
    showSlides(slideIndex);

    // Next/previous controls
    function plusSlides(n) {
        showSlides(slideIndex += n);
    }

    // Thumbnail image controls
    function currentSlide(n) {
        showSlides(slideIndex = n);
    }

    function showSlides(n) {
        var i;
        var slides = document.getElementsByClassName("mySlides");
        if (n > slides.length) { slideIndex = 1 }
        if (n < 1) { slideIndex = slides.length }
        for (i = 0; i < slides.length; i++) {
            slides[i].style.display = "none";
        }
        slides[slideIndex - 1].style.display = "block";
    }
    function moveSlide(n) {
        showSlide(slideIndex += n);
    }

    function showSlide(n) {
        var i;
        var slides = document.getElementsByClassName("slide");
        if (n > slides.length) {
            slideIndex = 1;
        }
        if (n < 1) {
            slideIndex = slides.length;
        }
        for (i = 0; i < slides.length; i++) {
            slides[i].style.display = "none";
            slides[i].style.opacity = 0;
        }
        slides[slideIndex - 1].style.display = "block";
        fadeIn(slides[slideIndex - 1]);
    }

    function fadeIn(element) {
        var opacity = 0;
        var timer = setInterval(function() {
            if (opacity >= 1) {
                clearInterval(timer);
            }
            element.style.opacity = opacity;
            opacity += 0.1;
        }, 50);
    }
        // Function to open the modal and display the clicked image
    function openModal(imageUrl) {
        var modal = document.getElementById("imageModal");
        var expandedImg = document.getElementById("expandedImg");
        expandedImg.src = imageUrl;
        modal.style.display = "block";
    }

    // Function to close the modal
    function closeModal() {
        var modal = document.getElementById("imageModal");
        modal.style.display = "none";
    }

    // Add the onclick attribute to each slide image to open the modal
    document.querySelectorAll('.slide').forEach(function(slide) {
        slide.onclick = function() {
            openModal(this.style.backgroundImage.slice(4, -1).replace(/"/g, ""));
        }
    });

</script>

{% endblock %}